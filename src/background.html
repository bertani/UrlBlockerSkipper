<script>
function resolve_domain(domain, sendResponse) {
    function return__resolve_domain(ip) {
        sendResponse({ip: ip});
    }
    req = new XMLHttpRequest();
    req.open("POST", "http://www.aorpapardopiemonte.it/utilita/Ip-dominio/IP-dominio.php", true);
    params = "myname="+domain+"&ipname="
    req.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    req.setRequestHeader("Content-length", params.length);
    req.setRequestHeader("Connection", "close"); 
    req.onreadystatechange = function() {
        if(req.readyState == 4 && req.status == 200) {
            start_p = req.responseText.indexOf("href=")+5;
            end_p = req.responseText.indexOf(" target", start_p);
            return__resolve_domain(req.responseText.substr(start_p, end_p-start_p));
        }
    }
    req.send(params);
}

chrome.extension.onRequest.addListener(
  function(request, sender, sendResponse) {
    if (request.type == "resolve") resolve_domain(request.domain, sendResponse);
  });

</script>
